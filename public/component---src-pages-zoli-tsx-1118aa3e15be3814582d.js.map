{"version":3,"sources":["webpack:///./node_modules/workerize-loader/dist/rpc-wrapper.js","webpack:///./src/components/layout.tsx","webpack:///./src/components/utils/sha256/sha256.worker.ts","webpack:///./src/components/utils/babel/babel.worker.ts","webpack:///./src/components/utils/renderer/renderer.worker.ts","webpack:///./src/components/utils/sha256/sha256.utils.ts","webpack:///./src/components/utils/sha.ts","webpack:///./src/components/utils/babel.ts","webpack:///./src/components/utils/renderer.ts","webpack:///./src/components/utils/babel/babel.utils.ts","webpack:///./src/components/utils/renderer/renderer.utils.tsx","webpack:///./src/pages/zoli.tsx"],"names":["module","exports","worker","methods","c","callbacks","addEventListener","e","d","data","type","id","f","error","Object","assign","Error","message","result","evt","document","createEvent","initEvent","method","params","dispatchEvent","forEach","_arguments","arguments","Promise","a","b","postMessage","slice","call","StyledContent","styled","div","Layout","location","title","children","header","to","pathname","__PATH_PREFIX__","name","content","Date","getFullYear","addMethods","w","Worker","sha256","msgBuffer","TextEncoder","encode","crypto","subtle","digest","hashBuffer","hashArray","Array","from","Uint8Array","hashHex","map","toString","join","loadedModule","sha256W","window","Sha256Worker","hashTable","hash","input","shortener","i","shorterHash","substr","undefined","strInput","JSON","stringify","unHash","str","TransformModule","transform","code","plugins","presets","transformW","TransformWorker","codeHash","transFormedCode","transformedCodeHash","RendererModule","render","pastEvents","console","log","React","ReactDOMServer","cc","Function","Component","props","renderToString","createElement","rendererW","RendererWorker","pastEventsHash","renderedString","renderedStringHash","MonacoEditor","lazy","CodeEditorWithFailBack","changeCode","Suspense","fallback","width","height","language","theme","value","options","onChange","Wrapper","ref","useRef","useEffect","Counter","ReactDOM","hydrate","current","innerHTML","dangerouslySetInnerHTML","__html","fill","target","pageQuery","ZedZoliPage","siteTitle","site","siteMetadata","useState","transformedCode","transformedHash","renderedHash","renderedContent","renderedComponent","changeWorkerRenderedComponent","runner","key"],"mappings":"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","file":"component---src-pages-zoli-tsx-1118aa3e15be3814582d.js","sourcesContent":["function addMethods(worker, methods) {\n  var c = 0;\n  var callbacks = {};\n  worker.addEventListener('message', function (e) {\n    var d = e.data;\n    if (d.type !== 'RPC') return;\n\n    if (d.id) {\n      var f = callbacks[d.id];\n\n      if (f) {\n        delete callbacks[d.id];\n\n        if (d.error) {\n          f[1](Object.assign(Error(d.error.message), d.error));\n        } else {\n          f[0](d.result);\n        }\n      }\n    } else {\n      var evt = document.createEvent('Event');\n      evt.initEvent(d.method, false, false);\n      evt.data = d.params;\n      worker.dispatchEvent(evt);\n    }\n  });\n  methods.forEach(function (method) {\n    worker[method] = function () {\n      var _arguments = arguments;\n      return new Promise(function (a, b) {\n        var id = ++c;\n        callbacks[id] = [a, b];\n        worker.postMessage({\n          type: 'RPC',\n          id: id,\n          method: method,\n          params: [].slice.call(_arguments)\n        });\n      });\n    };\n  });\n}\n\nmodule.exports = addMethods;","import * as React from \"react\";\nimport { Helmet } from \"react-helmet\";\nimport { Link } from \"gatsby\";\nimport styled from \"styled-components\";\n\ninterface Props {\n  location: Location;\n  title: string;\n}\n\nconst StyledContent = styled.div`\nmax-width: 1140px;\nmargin: auto;\n`;\n\nexport const Layout: React.FC<Props> = ({ location, title, children }) => {\n  let __PATH_PREFIX__;\n\n  const rootPath = `${__PATH_PREFIX__}/`;\n  let header = (\n    <h1>\n      <Link to={`/`}>{title}</Link>\n    </h1>\n  );\n  if (!(location && location.pathname)) header = <React.Fragment />;\n  else if (location.pathname === rootPath) {\n    header = (\n      <h1>\n        <Link to={`/`}>{title}</Link>\n      </h1>\n    );\n  } else {\n    header = (\n      <h2>\n        <Link to={`/`}>{title}</Link>\n      </h2>\n    );\n  }\n  return (\n    <React.Fragment>\n      <Helmet>\n        <meta\n          name=\"viewport\"\n          content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\"\n        />\n      </Helmet>\n      <StyledContent>\n        <header>{header}</header>\n        <main>{children}</main>\n        <footer>Â© {new Date().getFullYear()}, Zed vision</footer>\n      </StyledContent>\n    </React.Fragment>\n  );\n};\n","\n\t\t\t\tvar addMethods = require(\"../../../../node_modules/workerize-loader/dist/rpc-wrapper.js\")\n\t\t\t\tvar methods = [\"Sha256Worker\"]\n\t\t\t\tmodule.exports = function() {\n\t\t\t\t\tvar w = new Worker(__webpack_public_path__ + \"built-sha256.ccf220.worker.js\", { name: \"built-sha256.[hash:6].worker.js\" })\n\t\t\t\t\taddMethods(w, methods)\n\t\t\t\t\t\n\t\t\t\t\treturn w\n\t\t\t\t}\n\t\t\t","\n\t\t\t\tvar addMethods = require(\"../../../../node_modules/workerize-loader/dist/rpc-wrapper.js\")\n\t\t\t\tvar methods = [\"TransformWorker\"]\n\t\t\t\tmodule.exports = function() {\n\t\t\t\t\tvar w = new Worker(__webpack_public_path__ + \"built-babel.2ee398.worker.js\", { name: \"built-babel.[hash:6].worker.js\" })\n\t\t\t\t\taddMethods(w, methods)\n\t\t\t\t\t\n\t\t\t\t\treturn w\n\t\t\t\t}\n\t\t\t","\n\t\t\t\tvar addMethods = require(\"../../../../node_modules/workerize-loader/dist/rpc-wrapper.js\")\n\t\t\t\tvar methods = [\"RendererWorker\"]\n\t\t\t\tmodule.exports = function() {\n\t\t\t\t\tvar w = new Worker(__webpack_public_path__ + \"built-renderer.e556a3.worker.js\", { name: \"built-renderer.[hash:6].worker.js\" })\n\t\t\t\t\taddMethods(w, methods)\n\t\t\t\t\t\n\t\t\t\t\treturn w\n\t\t\t\t}\n\t\t\t","export const Sha256 = (hashTable = {}) => ({\n  hash: async (input: string | object) => {\n    const strInput = typeof input !== \"string\" ? JSON.stringify(input) : input;\n\n    const hash = await sha256(strInput);\n\n    const shorterHash = shortener(hash);\n\n    hashTable[hash] = input;\n\n    return shorterHash;\n    function shortener(hash: string) {\n      for (let i = 1; i < 64; i++) {\n        const shorterHash = hash.substr(0, i);\n        if (hashTable[shorterHash] === undefined) {\n          hashTable[shorterHash] = hash;\n          return shorterHash;\n        }\n\n        if (hashTable[shorterHash] === hash) return shorterHash;\n      }\n      return hash;\n    }\n  },\n  unHash: async (hash: string) => hashTable[hashTable[hash]],\n});\n\nasync function sha256(message: string) {\n  const msgBuffer = new TextEncoder().encode(message);\n\n  const hashBuffer = await crypto.subtle.digest(\"SHA-256\", msgBuffer);\n\n  const hashArray = Array.from(new Uint8Array(hashBuffer));\n\n  // convert bytes to hex string\n  const hashHex = hashArray.map((b) => (\"00\" + b.toString(16)).slice(-2)).join(\n    \"\",\n  );\n  return hashHex;\n}\n","import { Sha256Worker } from \"./sha256/sha256.worker\";\nimport { Sha256 } from \"./sha256/sha256.utils\";\n\nconst sha256W = ((typeof window !== \"undefined\") && Sha256Worker) || Sha256;\n\nlet loadedModule: any;\n\nexport const { hash, unHash } = {\n  hash: async (str: string | object) => {\n    if (!loadedModule) {\n      loadedModule = await sha256W();\n    }\n    return loadedModule.hash(str);\n  },\n  unHash: async (hash: string) => {\n    if (!loadedModule) {\n      loadedModule = await sha256W();\n    }\n    return loadedModule.unHash(hash);\n  },\n};\n","import { TransformWorker } from \"./babel/babel.worker\";\nimport { TransformModule } from \"./babel/babel.utils\";\nimport { hash, unHash } from \"./sha\";\nconst transformW = ((typeof window !== \"undefined\") && TransformWorker) ||\n  TransformModule;\n\nlet loadedModule: any;\n\nexport const transform = async (codeHash: string) => {\n  if (!loadedModule) {\n    loadedModule = await transformW();\n  }\n  const code = await unHash(codeHash);\n\n  const transFormedCode = await loadedModule.transform(code);\n  const transformedCodeHash = await hash(transFormedCode);\n  return transformedCodeHash;\n};\n","import { RendererWorker } from \"./renderer/renderer.worker\";\nimport { RendererModule } from \"./renderer/renderer.utils\";\nimport { hash, unHash } from \"./sha\";\n\nconst rendererW = ((typeof window !== \"undefined\") && RendererWorker) ||\n  RendererModule;\n\nlet loadedModule: any;\n\nexport const render = async (\n  transformedCodeHash: string,\n  pastEventsHash: string,\n) => {\n  if (!loadedModule) {\n    loadedModule = await rendererW();\n  }\n  console.log(\"RENDER it\");\n  const code = await unHash(transformedCodeHash);\n  const pastEvents = await unHash(pastEventsHash);\n\n  const renderedString = await loadedModule.render(code, pastEvents);\n  const renderedStringHash = await hash(renderedString);\n  return renderedStringHash;\n};\n","import { transform } from \"@babel/standalone\";\n\nexport const TransformModule = async () => ({\n  transform: async (code: string) => {\n    return transform(code, {\n      plugins: [],\n      presets: [\"react\"],\n    }).code;\n  },\n});\n","import React from \"react\";\nimport ReactDOMServer from \"react-dom/server\";\n\nexport const RendererModule = async () => ({\n  render: async (code: string, pastEvents: any[]) => {\n    console.log(React, ReactDOMServer);\n\n    const cc = new Function(\n      \"props\",\n      \"React\",\n      `return (${code})(props)`,\n    );\n    const Component = (props: any) => cc(props, React);\n\n    return ReactDOMServer.renderToString(\n      React.createElement(Component, { pastEvents }),\n    );\n  },\n});\n","import React from \"react\";\n\nimport ReactDOM from \"react-dom\";\n\nimport { Layout } from \"../components/layout\";\nimport { SEO } from \"../components/seo\";\n// import { ChangeDetector } from \"../components/changeDetector\";\nimport { graphql } from \"gatsby\";\n\nimport { hash, unHash } from \"../components/utils/sha\";\nimport { transform } from \"../components/utils/babel\";\nimport { render } from \"../components/utils/renderer\";\n// import JSONPretty from \"react-jso\\n-pretty\";\n\nconst MonacoEditor = React.lazy(() => import(\"react-monaco-editor\"));\n\nconst CodeEditorWithFailBack: React.FC<\n  { code: string; changeCode: (code: string) => void }\n> = ({ code, changeCode }) =>\n  <div>\n    <React.Suspense fallback={<div>Loading...</div>}>\n      <MonacoEditor\n        width=\"800\"\n        height=\"600\"\n        language=\"javascript\"\n        theme=\"vs-dark\"\n        value={code}\n        options={{}}\n        onChange={changeCode}\n      />\n    </React.Suspense>\n  </div>;\n\ninterface Props {\n  data: {\n    site: {\n      siteMetadata: {\n        title: string;\n      };\n    };\n  };\n  location: Location;\n}\n\nconst Wrapper = (props: any) => {\n  const ref = React.useRef(null);\n\n  React.useEffect(() => {\n    const pastEvents = props.pastEvents;\n    if (props.code) {\n      const cc = new Function(\n        \"props\",\n        \"React\",\n        `return (${props.code})(props)`,\n      );\n      const Counter = (props: any) => cc(props, React);\n      ReactDOM.hydrate(<Counter pastEvents={pastEvents} />, ref.current);\n    }\n  }, [props.innerHTML]);\n\n  return <div\n    ref={ref}\n    dangerouslySetInnerHTML={{ __html: props.innerHTML }}\n  />;\n};\n\n// const Comp1: React.FC<{ onEvent: (event: string) => void }> = ({ onEvent }) => {\n//   const [count, setCount] = React.useState(0);\n\n//   return (\n//     <React.Fragment>\n//       <button\n//         onClick={() => {\n//           onEvent(\"double\");\n//           setCount(count * 2);\n//         }}\n//       >\n//         x 2\n//       </button>\n//       <button\n//         onClick={() => {\n//           onEvent(\"inc\");\n//           setCount(count + 1);\n//         }}\n//       >\n//         +\n//       </button>\n//       {count}\n//       <button\n//         onClick={() => {\n//           onEvent(\"dec\");\n//           setCount(count - 1);\n//         }}\n//       >\n//         -\n//       </button>\n//     </React.Fragment>\n//   );\n// };\n\nconst counter = `function Counter(props){\n  const actions = {\n    decrease: state => ({ counter: state.counter - 1 }),  \n    double: state => ({ counter: state.counter * 2 }),\n    increase: state => ({ counter: state.counter + 1 }),\n  }\n  const pastEvents = props.pastEvents || []\n  \n\n  const [events, setEvents] = React.useState(pastEvents)\n\n  const state = events\n    .map(ev => {\n      const text = ev.target\n      if (text.includes(\"-\")) return \"decrease\"\n      else if (text.includes(\"+\")) return \"increase\"\n      else if (text.includes(\"x2\")) return \"double\"\n    })\n    .reduce((state, ev) => actions[ev](state), { counter: 0 })\n    \n  const onClick = e =>\n    setEvents([...events, { type: \"click\", target: String(e.target.innerHTML) }])\n\n  return (\n    <div>\n      <button onClick={e => onClick(e)}>-</button>\n      <button onClick={e => onClick(e)}>x2</button>\n      CountEEer {props.name}:<span>{state.counter}</span>\n      <button onClick={e => onClick(e)}>+</button>\n    </div>\n  )\n}\n`;\n\nconst pastEvents = new Array(100000).fill({\n  target: \"+\",\n  type: \"click\",\n});\n\nconst ZedZoliPage = ({ data, location }: Props) => {\n  const siteTitle = data.site.siteMetadata.title;\n\n  const [renderedComponent, changeWorkerRenderedComponent] = React.useState(\n    {\n      code: ``,\n      transformedCode: ``,\n      pastEvents,\n      pastEventsHash: ``,\n      codeHash: ``,\n      transformedHash: ``,\n      renderedHash: ``,\n      renderedContent: ``,\n    },\n  );\n  const [code, changeCode] = React.useState(counter);\n\n  React.useEffect(() => {\n    const runner = async () => {\n      const codeHash = await hash(code);\n      const transformedHash = await transform(codeHash);\n\n      const pastEventsHash = await hash(pastEvents);\n      const transformedCode = await unHash(transformedHash);\n      const renderedHash = await render(transformedHash, pastEventsHash);\n      const renderedContent = await unHash(renderedHash);\n\n      changeWorkerRenderedComponent(\n        {\n          code: code,\n          codeHash,\n          transformedHash,\n          transformedCode: transformedCode,\n          pastEvents,\n          pastEventsHash,\n          renderedHash,\n          renderedContent,\n        },\n      );\n    };\n    if (typeof window !== \"undefined\") runner();\n  }, [code]);\n\n  return (\n    <Layout location={location} title={siteTitle}>\n      <SEO title=\"Test Worker side rendering\" />\n      {(typeof window !== \"undefined\") &&\n        <CodeEditorWithFailBack code={code} changeCode={changeCode} />}\n      <br />\n      <Wrapper\n        key={renderedComponent.renderedHash}\n        code={renderedComponent.transformedCode}\n        pastEvents={renderedComponent.pastEvents}\n        innerHTML={renderedComponent.renderedContent}\n      />\n      {/* <br /> */}\n\n      {/* <JSONPretty\n        id=\"json-pretty\"\n        data={{\n          codeHash: renderedComponent.codeHash,\n          transformedHash: renderedComponent.transformedHash,\n          pastEventsHash: renderedComponent.pastEventsHash,\n          renderedHash: renderedComponent.renderedHash,\n        }}\n      /> */}\n\n      {/* <hr />\n      <hr />\n      <hr /> */}\n      {/* <ChangeDetector Comp1={Comp1}></ChangeDetector> */}\n      {/* <p>Worker side rendering</p> */}\n      {/* <div id=\"zoli\"></div> */}\n    </Layout>\n  );\n};\n\nexport default ZedZoliPage;\n\nexport const pageQuery = graphql`\n  query {\n    site {\n      siteMetadata {\n        title\n      }\n    }\n  }\n`;\n"],"sourceRoot":""}